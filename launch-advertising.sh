#!/bin/bash

# Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ñ€ÐµÐºÐ»Ð°Ð¼Ð½Ð¾Ð¹ ÐºÐ°Ð¼Ð¿Ð°Ð½Ð¸Ð¸

set -e

# Ð¦Ð²ÐµÑ‚Ð° Ð´Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð°
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

log() {
    echo -e "${GREEN}[$(date '+%Y-%m-%d %H:%M:%S')]${NC} $1"
}

warn() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

info() {
    echo -e "${BLUE}[INFO]${NC} $1"
}

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Telegram ÐºÐ°Ð½Ð°Ð»Ð°
create_telegram_channel() {
    log "Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Telegram ÐºÐ°Ð½Ð°Ð»Ð°..."
    
    echo "Ð”Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Telegram ÐºÐ°Ð½Ð°Ð»Ð° Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ ÑˆÐ°Ð³Ð¸:"
    echo ""
    echo "1. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Telegram Ð¸ Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ 'Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÐºÐ°Ð½Ð°Ð»'"
    echo "2. Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ: 'Xray VPN Service'"
    echo "3. Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ:"
    echo "   'ðŸš€ ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº YouTube, Instagram, Facebook"
    echo "   ðŸ”¹ Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ñ‡ÐµÑ€ÐµÐ· Ð¼Ð¾Ð±Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚"
    echo "   ðŸ”¹ ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¹"
    echo "   ðŸ”¹ Ð‘ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ñ‹Ð¹ Ñ‚ÐµÑÑ‚ Ð½Ð° 1 Ð´ÐµÐ½ÑŒ"
    echo "   ðŸ”¹ Ð ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð°'"
    echo "4. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¾Ñ‚Ð¸Ð¿ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)"
    echo "5. Ð¡Ð´ÐµÐ»Ð°Ð¹Ñ‚Ðµ ÐºÐ°Ð½Ð°Ð» Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¼"
    echo "6. Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ ÑÑÑ‹Ð»ÐºÑƒ Ð½Ð° ÐºÐ°Ð½Ð°Ð»"
    echo ""
    
    read -p "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÑÑÑ‹Ð»ÐºÑƒ Ð½Ð° ÐºÐ°Ð½Ð°Ð»: " CHANNEL_URL
    
    if [[ -n "$CHANNEL_URL" ]]; then
        log "âœ… ÐšÐ°Ð½Ð°Ð» ÑÐ¾Ð·Ð´Ð°Ð½: $CHANNEL_URL"
        
        # Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð±Ð¾Ñ‚Ð° Ð² ÐºÐ°Ð½Ð°Ð» ÐºÐ°Ðº Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð°
        BOT_TOKEN=$(grep "BOT_TOKEN" /opt/xray-service/.env | cut -d= -f2)
        bot_username=$(curl -s "https://api.telegram.org/bot$BOT_TOKEN/getMe" | jq -r '.result.username')
        
        info "Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð±Ð¾Ñ‚Ð° @$bot_username Ð² ÐºÐ°Ð½Ð°Ð» ÐºÐ°Ðº Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð°"
        info "ÐŸÑ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ Ð¿Ñ€Ð°Ð²Ð° Ð½Ð° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÑƒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹"
    else
        warn "Ð¡ÑÑ‹Ð»ÐºÐ° Ð½Ð° ÐºÐ°Ð½Ð°Ð» Ð½Ðµ ÑƒÐºÐ°Ð·Ð°Ð½Ð°"
    fi
}

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ñ€ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹
setup_referral_program() {
    log "ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ñ€ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹..."
    
    echo "Ð ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð° Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸:"
    echo ""
    echo "âœ… ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½ÑƒÑŽ Ñ€ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½ÑƒÑŽ ÑÑÑ‹Ð»ÐºÑƒ"
    echo "âœ… 10% Ð¾Ñ‚ Ð¿ÐµÑ€Ð²Ð¾Ð¹ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸ Ñ€ÐµÑ„ÐµÑ€Ð°Ð»Ð°"
    echo "âœ… 10% Ð¾Ñ‚ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ñ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ¸ Ñ€ÐµÑ„ÐµÑ€Ð°Ð»Ð°"
    echo "âœ… Ð‘Ð¾Ð½ÑƒÑÑ‹ Ð½Ð°Ñ‡Ð¸ÑÐ»ÑÑŽÑ‚ÑÑ Ð½Ð° Ð±Ð°Ð»Ð°Ð½Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ"
    echo "âœ… ÐœÐ¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ñ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ¸ Ð¸Ð»Ð¸ Ð²Ñ‹Ð²ÐµÑÑ‚Ð¸"
    echo ""
    
    info "Ð ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð° Ð³Ð¾Ñ‚Ð¾Ð²Ð° Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ðµ!"
}

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ€ÐµÐºÐ»Ð°Ð¼Ð½Ñ‹Ñ… Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð¾Ð²
create_ad_materials() {
    log "Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ€ÐµÐºÐ»Ð°Ð¼Ð½Ñ‹Ñ… Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð¾Ð²..."
    
    # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸ Ð´Ð»Ñ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð¾Ð²
    mkdir -p /opt/xray-service/ad-materials
    
    # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ‚ÐµÐºÑÑ‚Ð° Ð´Ð»Ñ Ñ€ÐµÐºÐ»Ð°Ð¼Ñ‹
    cat > /opt/xray-service/ad-materials/ad-text.txt << 'EOF'
ðŸš€ Xray VLESS + Reality Service

ðŸ”¹ ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº YouTube, Instagram, Facebook
ðŸ”¹ Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ñ‡ÐµÑ€ÐµÐ· Ð¼Ð¾Ð±Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚ (ÐœÐ¢Ð¡, ÐœÐµÐ³Ð°Ñ„Ð¾Ð½, Ð‘Ð¸Ð»Ð°Ð¹Ð½, Ð¢ÐµÐ»Ðµ2)
ðŸ”¹ ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¹
ðŸ”¹ Ð‘ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ñ‹Ð¹ Ñ‚ÐµÑÑ‚ Ð½Ð° 1 Ð´ÐµÐ½ÑŒ
ðŸ”¹ Ð ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð° (10% Ð¾Ñ‚ ÐºÐ°Ð¶Ð´Ð¾Ð¹ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð¸)

ðŸ’° Ð¦ÐµÐ½Ñ‹:
â€¢ ÐœÐµÑÑÑ†: 200â‚½
â€¢ Ð“Ð¾Ð´: 2000â‚½ (ÑÐºÐ¸Ð´ÐºÐ° 17%)

ðŸ’³ Ð¡Ð¿Ð¾ÑÐ¾Ð±Ñ‹ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹:
â€¢ YooKassa (ÐºÐ°Ñ€Ñ‚Ñ‹, Ð¡Ð‘ÐŸ, ÑÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ñ‹Ðµ ÐºÐ¾ÑˆÐµÐ»ÑŒÐºÐ¸)
â€¢ Robokassa (ÐºÐ°Ñ€Ñ‚Ñ‹, Ð¡Ð‘ÐŸ, ÑÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ñ‹Ðµ ÐºÐ¾ÑˆÐµÐ»ÑŒÐºÐ¸)
â€¢ ÐšÑ€Ð¸Ð¿Ñ‚Ð¾Ð²Ð°Ð»ÑŽÑ‚Ñ‹ (Bitcoin, Ethereum, USDT)

ðŸŽ Ð ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð°:
â€¢ ÐŸÑ€Ð¸Ð²Ð¾Ð´Ð¸Ñ‚Ðµ Ð´Ñ€ÑƒÐ·ÐµÐ¹ Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ð¹Ñ‚Ðµ 10% Ð¾Ñ‚ Ð¸Ñ… Ð¿Ð¾ÐºÑƒÐ¿Ð¾Ðº
â€¢ Ð‘Ð¾Ð½ÑƒÑÑ‹ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ñ Ð¸Ð»Ð¸ Ð²Ñ‹Ð²ÐµÑÑ‚Ð¸

ðŸ“± ÐÐ°Ñ‡Ð°Ñ‚ÑŒ: @your_bot_username
EOF
    
    # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ‚ÐµÐºÑÑ‚Ð° Ð´Ð»Ñ Ð¿Ð¾ÑÑ‚Ð¾Ð²
    cat > /opt/xray-service/ad-materials/post-text.txt << 'EOF'
ðŸ”¥ ÐÐžÐ’Ð˜ÐÐšÐ! Xray VLESS + Reality Service

Ð¢ÐµÐ¿ÐµÑ€ÑŒ YouTube, Instagram Ð¸ Facebook Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ñ‡ÐµÑ€ÐµÐ· Ð¼Ð¾Ð±Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚!

âœ… Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð½Ð° Ð²ÑÐµÑ… Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð°Ñ… (ÐœÐ¢Ð¡, ÐœÐµÐ³Ð°Ñ„Ð¾Ð½, Ð‘Ð¸Ð»Ð°Ð¹Ð½, Ð¢ÐµÐ»Ðµ2)
âœ… ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¹
âœ… Ð¡Ñ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð¾Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ
âœ… Ð‘Ñ‹ÑÑ‚Ñ€Ð°Ñ ÑÐºÐ¾Ñ€Ð¾ÑÑ‚ÑŒ

ðŸŽ Ð‘Ð•Ð¡ÐŸÐ›ÐÐ¢ÐÐ«Ð™ Ð¢Ð•Ð¡Ð¢ ÐÐ 1 Ð”Ð•ÐÐ¬!

ðŸ’° Ð’ÑÐµÐ³Ð¾ 200â‚½ Ð² Ð¼ÐµÑÑÑ† Ð·Ð° Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿ ÐºÐ¾ Ð²ÑÐµÐ¼ ÑÐ°Ð¹Ñ‚Ð°Ð¼

ðŸ“± ÐŸÐµÑ€ÐµÑ…Ð¾Ð´Ð¸Ñ‚Ðµ Ðº Ð±Ð¾Ñ‚Ñƒ: @your_bot_username
EOF
    
    # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ‚ÐµÐºÑÑ‚Ð° Ð´Ð»Ñ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¹
    cat > /opt/xray-service/ad-materials/story-text.txt << 'EOF'
ðŸš€ Xray VPN Service

ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº YouTube, Instagram, Facebook Ñ‡ÐµÑ€ÐµÐ· Ð¼Ð¾Ð±Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚!

ðŸ”¹ Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð½Ð° Ð²ÑÐµÑ… Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð°Ñ…
ðŸ”¹ ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ
ðŸ”¹ Ð¡Ñ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð¾Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ

ðŸŽ Ð‘ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ñ‹Ð¹ Ñ‚ÐµÑÑ‚ Ð½Ð° 1 Ð´ÐµÐ½ÑŒ!

@your_bot_username
EOF
    
    log "Ð ÐµÐºÐ»Ð°Ð¼Ð½Ñ‹Ðµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ñ‹ ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ Ð² /opt/xray-service/ad-materials/"
    
    info "Ð¡Ð¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ñ‹:"
    info "â€¢ ad-text.txt - Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ñ€ÐµÐºÐ»Ð°Ð¼Ð½Ñ‹Ð¹ Ñ‚ÐµÐºÑÑ‚"
    info "â€¢ post-text.txt - Ñ‚ÐµÐºÑÑ‚ Ð´Ð»Ñ Ð¿Ð¾ÑÑ‚Ð¾Ð²"
    info "â€¢ story-text.txt - Ñ‚ÐµÐºÑÑ‚ Ð´Ð»Ñ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¹"
}

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° Ñ€ÐµÐºÐ»Ð°Ð¼Ñ‹
setup_ad_monitoring() {
    log "ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° Ñ€ÐµÐºÐ»Ð°Ð¼Ñ‹..."
    
    # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð° Ð´Ð»Ñ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸
    cat > /opt/xray-service/scripts/monitor-advertising.sh << 'EOF'
#!/bin/bash

# Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° Ñ€ÐµÐºÐ»Ð°Ð¼Ð½Ð¾Ð¹ ÐºÐ°Ð¼Ð¿Ð°Ð½Ð¸Ð¸

LOG_FILE="/var/log/advertising-monitor.log"

log() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" | tee -a "$LOG_FILE"
}

# ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
get_user_stats() {
    cd /opt/xray-service
    
    # ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
    total_users=$(docker exec xray-service_postgres_1 psql -U xray_user -d xray_service -t -c "SELECT COUNT(*) FROM users;" | tr -d ' ')
    
    # ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¾Ðº
    active_subscriptions=$(docker exec xray-service_postgres_1 psql -U xray_user -d xray_service -t -c "SELECT COUNT(*) FROM subscriptions WHERE is_active = true;" | tr -d ' ')
    
    # ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹ Ð·Ð° ÑÐµÐ³Ð¾Ð´Ð½Ñ
    today_payments=$(docker exec xray-service_postgres_1 psql -U xray_user -d xray_service -t -c "SELECT COUNT(*) FROM payments WHERE DATE(created_at) = CURRENT_DATE;" | tr -d ' ')
    
    # Ð¡ÑƒÐ¼Ð¼Ð° Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹ Ð·Ð° ÑÐµÐ³Ð¾Ð´Ð½Ñ
    today_revenue=$(docker exec xray-service_postgres_1 psql -U xray_user -d xray_service -t -c "SELECT COALESCE(SUM(amount), 0) FROM payments WHERE DATE(created_at) = CURRENT_DATE AND status = 'succeeded';" | tr -d ' ')
    
    log "Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð·Ð° $(date '+%Y-%m-%d'):"
    log "â€¢ Ð’ÑÐµÐ³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹: $total_users"
    log "â€¢ ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¾Ðº: $active_subscriptions"
    log "â€¢ ÐŸÐ»Ð°Ñ‚ÐµÐ¶ÐµÐ¹ Ð·Ð° ÑÐµÐ³Ð¾Ð´Ð½Ñ: $today_payments"
    log "â€¢ Ð”Ð¾Ñ…Ð¾Ð´ Ð·Ð° ÑÐµÐ³Ð¾Ð´Ð½Ñ: $today_revenueâ‚½"
}

# ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸ Ð² Telegram
send_stats_to_telegram() {
    BOT_TOKEN=$(grep "BOT_TOKEN" /opt/xray-service/.env | cut -d= -f2)
    ADMIN_CHAT_ID=$(grep "ADMIN_CHAT_ID" /opt/xray-service/.env | cut -d= -f2)
    
    if [[ -n "$BOT_TOKEN" && -n "$ADMIN_CHAT_ID" ]]; then
        stats_message="ðŸ“Š Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð·Ð° $(date '+%Y-%m-%d'):\n\nâ€¢ Ð’ÑÐµÐ³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹: $total_users\nâ€¢ ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¾Ðº: $active_subscriptions\nâ€¢ ÐŸÐ»Ð°Ñ‚ÐµÐ¶ÐµÐ¹ Ð·Ð° ÑÐµÐ³Ð¾Ð´Ð½Ñ: $today_payments\nâ€¢ Ð”Ð¾Ñ…Ð¾Ð´ Ð·Ð° ÑÐµÐ³Ð¾Ð´Ð½Ñ: $today_revenueâ‚½"
        
        curl -s -X POST "https://api.telegram.org/bot$BOT_TOKEN/sendMessage" \
            -d chat_id="$ADMIN_CHAT_ID" \
            -d text="$stats_message"
    fi
}

# ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ
main() {
    get_user_stats
    send_stats_to_telegram
}

main "$@"
EOF
    
    chmod +x /opt/xray-service/scripts/monitor-advertising.sh
    
    # Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð² cron Ð´Ð»Ñ ÐµÐ¶ÐµÐ´Ð½ÐµÐ²Ð½Ð¾Ð³Ð¾ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°
    echo "0 9 * * * /opt/xray-service/scripts/monitor-advertising.sh" | crontab -
    
    log "ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ñ€ÐµÐºÐ»Ð°Ð¼Ñ‹ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½"
}

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð»Ð°Ð½Ð° Ñ€ÐµÐºÐ»Ð°Ð¼Ð½Ð¾Ð¹ ÐºÐ°Ð¼Ð¿Ð°Ð½Ð¸Ð¸
create_advertising_plan() {
    log "Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð»Ð°Ð½Ð° Ñ€ÐµÐºÐ»Ð°Ð¼Ð½Ð¾Ð¹ ÐºÐ°Ð¼Ð¿Ð°Ð½Ð¸Ð¸..."
    
    cat > /opt/xray-service/ad-materials/advertising-plan.txt << 'EOF'
ðŸ“‹ ÐŸÐ›ÐÐ Ð Ð•ÐšÐ›ÐÐœÐÐžÐ™ ÐšÐÐœÐŸÐÐÐ˜Ð˜

ðŸŽ¯ Ð¦Ð•Ð›Ð˜:
â€¢ ÐŸÑ€Ð¸Ð²Ð»ÐµÑ‡ÑŒ 1000 Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð² Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ð¼ÐµÑÑÑ†
â€¢ Ð”Ð¾ÑÑ‚Ð¸Ñ‡ÑŒ 100 Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¾Ðº
â€¢ ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð´Ð¾Ñ…Ð¾Ð´ 20,000â‚½ Ð² Ð¼ÐµÑÑÑ†

ðŸ“± ÐšÐÐÐÐ›Ð« ÐŸÐ ÐžÐ”Ð’Ð˜Ð–Ð•ÐÐ˜Ð¯:

1. TELEGRAM ÐšÐÐÐÐ›Ð«:
   â€¢ ÐŸÐ¾Ð¸ÑÐº ÐºÐ°Ð½Ð°Ð»Ð¾Ð² Ð¿Ð¾ Ñ‚ÐµÐ¼Ð°Ñ‚Ð¸ÐºÐµ VPN, Ð¾Ð±Ñ…Ð¾Ð´ Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð¾Ðº
   â€¢ Ð Ð°Ð·Ð¼ÐµÑ‰ÐµÐ½Ð¸Ðµ Ñ€ÐµÐºÐ»Ð°Ð¼Ñ‹ Ð² ÐºÐ°Ð½Ð°Ð»Ð°Ñ… Ñ Ð°ÑƒÐ´Ð¸Ñ‚Ð¾Ñ€Ð¸ÐµÐ¹ 10K+
   â€¢ Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ: 500-2000â‚½ Ð·Ð° Ð¿Ð¾ÑÑ‚
   â€¢ ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ð¹ Ð¾Ñ…Ð²Ð°Ñ‚: 50,000+ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº

2. TELEGRAM Ð“Ð Ð£ÐŸÐŸÐ«:
   â€¢ ÐŸÐ¾Ð¸ÑÐº Ð³Ñ€ÑƒÐ¿Ð¿ Ð¿Ð¾ Ñ‚ÐµÐ¼Ð°Ñ‚Ð¸ÐºÐµ IT, Ñ‚ÐµÑ…Ð½Ð¾Ð»Ð¾Ð³Ð¸Ð¸, Ð¾Ð±Ñ…Ð¾Ð´ Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð¾Ðº
   â€¢ Ð Ð°Ð·Ð¼ÐµÑ‰ÐµÐ½Ð¸Ðµ Ñ€ÐµÐºÐ»Ð°Ð¼Ñ‹ Ð² Ð³Ñ€ÑƒÐ¿Ð¿Ð°Ñ… Ñ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾Ð¹ Ð°ÑƒÐ´Ð¸Ñ‚Ð¾Ñ€Ð¸ÐµÐ¹
   â€¢ Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ: 200-1000â‚½ Ð·Ð° Ð¿Ð¾ÑÑ‚
   â€¢ ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ð¹ Ð¾Ñ…Ð²Ð°Ñ‚: 20,000+ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº

3. Ð¡ÐžÐ¦Ð˜ÐÐ›Ð¬ÐÐ«Ð• Ð¡Ð•Ð¢Ð˜:
   â€¢ VKontakte: Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ Ð¿Ð¾ IT, Ñ‚ÐµÑ…Ð½Ð¾Ð»Ð¾Ð³Ð¸Ð¸
   â€¢ ÐžÐ´Ð½Ð¾ÐºÐ»Ð°ÑÑÐ½Ð¸ÐºÐ¸: Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ Ð¿Ð¾ Ð¾Ð±Ñ…Ð¾Ð´Ñƒ Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð¾Ðº
   â€¢ Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ: 300-1500â‚½ Ð·Ð° Ð¿Ð¾ÑÑ‚
   â€¢ ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ð¹ Ð¾Ñ…Ð²Ð°Ñ‚: 30,000+ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº

4. Ð¤ÐžÐ Ð£ÐœÐ« Ð˜ Ð¡ÐÐ™Ð¢Ð«:
   â€¢ IT Ñ„Ð¾Ñ€ÑƒÐ¼Ñ‹, ÑÐ°Ð¹Ñ‚Ñ‹ Ð¿Ð¾ Ð¾Ð±Ñ…Ð¾Ð´Ñƒ Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð¾Ðº
   â€¢ Ð Ð°Ð·Ð¼ÐµÑ‰ÐµÐ½Ð¸Ðµ Ñ€ÐµÐºÐ»Ð°Ð¼Ñ‹ Ð² Ñ‚ÐµÐ¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ñ€Ð°Ð·Ð´ÐµÐ»Ð°Ñ…
   â€¢ Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ: 500-3000â‚½ Ð·Ð° Ñ€Ð°Ð·Ð¼ÐµÑ‰ÐµÐ½Ð¸Ðµ
   â€¢ ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ð¹ Ð¾Ñ…Ð²Ð°Ñ‚: 15,000+ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº

ðŸ’° Ð‘Ð®Ð”Ð–Ð•Ð¢ ÐÐ Ð Ð•ÐšÐ›ÐÐœÐ£:
â€¢ ÐÐµÐ´ÐµÐ»Ñ 1: 5,000â‚½
â€¢ ÐÐµÐ´ÐµÐ»Ñ 2: 7,500â‚½
â€¢ ÐÐµÐ´ÐµÐ»Ñ 3: 10,000â‚½
â€¢ ÐÐµÐ´ÐµÐ»Ñ 4: 12,500â‚½
â€¢ Ð˜Ñ‚Ð¾Ð³Ð¾: 35,000â‚½ Ð² Ð¼ÐµÑÑÑ†

ðŸ“Š ÐœÐ•Ð¢Ð Ð˜ÐšÐ˜ Ð”Ð›Ð¯ ÐžÐ¢Ð¡Ð›Ð•Ð–Ð˜Ð’ÐÐÐ˜Ð¯:
â€¢ ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¾Ð² Ð¿Ð¾ Ñ€ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½Ñ‹Ð¼ ÑÑÑ‹Ð»ÐºÐ°Ð¼
â€¢ ÐšÐ¾Ð½Ð²ÐµÑ€ÑÐ¸Ñ Ð² Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸ÑŽ
â€¢ ÐšÐ¾Ð½Ð²ÐµÑ€ÑÐ¸Ñ Ð² Ð¿Ð¾ÐºÑƒÐ¿ÐºÑƒ
â€¢ Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ Ñ‡ÐµÐº
â€¢ LTV (Lifetime Value) Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ

ðŸŽ ÐŸÐ ÐžÐœÐž-ÐÐšÐ¦Ð˜Ð˜:
â€¢ Ð‘ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ñ‹Ð¹ Ñ‚ÐµÑÑ‚ Ð½Ð° 1 Ð´ÐµÐ½ÑŒ
â€¢ Ð¡ÐºÐ¸Ð´ÐºÐ° 20% Ð½Ð° Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ð¼ÐµÑÑÑ† Ð´Ð»Ñ Ð½Ð¾Ð²Ñ‹Ñ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
â€¢ Ð‘Ð¾Ð½ÑƒÑ 100â‚½ Ð·Ð° Ð¿Ñ€Ð¸Ð²Ð»ÐµÑ‡ÐµÐ½Ð¸Ðµ 5 Ñ€ÐµÑ„ÐµÑ€Ð°Ð»Ð¾Ð²
â€¢ Ð¡ÐºÐ¸Ð´ÐºÐ° 17% Ð¿Ñ€Ð¸ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐµ Ð³Ð¾Ð´Ð¾Ð²Ð¾Ð¹ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ¸

ðŸ“ˆ ÐŸÐ›ÐÐ Ð ÐžÐ¡Ð¢Ð:
â€¢ ÐœÐµÑÑÑ† 1: 1000 Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹, 100 Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¾Ðº
â€¢ ÐœÐµÑÑÑ† 2: 2500 Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹, 300 Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¾Ðº
â€¢ ÐœÐµÑÑÑ† 3: 5000 Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹, 600 Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¾Ðº
â€¢ ÐœÐµÑÑÑ† 6: 15000 Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹, 2000 Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¾Ðº
â€¢ ÐœÐµÑÑÑ† 12: 50000 Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹, 8000 Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¾Ðº
EOF
    
    log "ÐŸÐ»Ð°Ð½ Ñ€ÐµÐºÐ»Ð°Ð¼Ð½Ð¾Ð¹ ÐºÐ°Ð¼Ð¿Ð°Ð½Ð¸Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½"
}

# ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ
main() {
    log "ðŸ“¢ Ð—Ð°Ð¿ÑƒÑÐº Ñ€ÐµÐºÐ»Ð°Ð¼Ð½Ð¾Ð¹ ÐºÐ°Ð¼Ð¿Ð°Ð½Ð¸Ð¸..."
    
    echo "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ:"
    echo "1. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Telegram ÐºÐ°Ð½Ð°Ð»"
    echo "2. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑŒ Ñ€ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½ÑƒÑŽ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñƒ"
    echo "3. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ñ€ÐµÐºÐ»Ð°Ð¼Ð½Ñ‹Ðµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ñ‹"
    echo "4. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑŒ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ñ€ÐµÐºÐ»Ð°Ð¼Ñ‹"
    echo "5. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿Ð»Ð°Ð½ Ñ€ÐµÐºÐ»Ð°Ð¼Ð½Ð¾Ð¹ ÐºÐ°Ð¼Ð¿Ð°Ð½Ð¸Ð¸"
    echo "6. Ð’ÑÐµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ"
    
    read -p "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð½Ð¾Ð¼ÐµÑ€ (1-6): " choice
    
    case $choice in
        1)
            create_telegram_channel
            ;;
        2)
            setup_referral_program
            ;;
        3)
            create_ad_materials
            ;;
        4)
            setup_ad_monitoring
            ;;
        5)
            create_advertising_plan
            ;;
        6)
            create_telegram_channel
            setup_referral_program
            create_ad_materials
            setup_ad_monitoring
            create_advertising_plan
            ;;
        *)
            error "ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð²Ñ‹Ð±Ð¾Ñ€"
            exit 1
            ;;
    esac
    
    log "ðŸŽ‰ Ð ÐµÐºÐ»Ð°Ð¼Ð½Ð°Ñ ÐºÐ°Ð¼Ð¿Ð°Ð½Ð¸Ñ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð°!"
    
    info "Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ ÑˆÐ°Ð³Ð¸:"
    info "1. Ð Ð°Ð·Ð¼ÐµÑÑ‚Ð¸Ñ‚Ðµ Ñ€ÐµÐºÐ»Ð°Ð¼Ñƒ Ð² Telegram ÐºÐ°Ð½Ð°Ð»Ð°Ñ…"
    info "2. ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€ÑŒÑ‚Ðµ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÑƒ Ñ‡ÐµÑ€ÐµÐ· Ð±Ð¾Ñ‚Ð°"
    info "3. ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ñ€ÐµÐºÐ»Ð°Ð¼Ð½Ñ‹Ðµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ñ‹"
    info "4. ÐœÐ°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ ÑƒÑÐ¿ÐµÑˆÐ½Ñ‹Ðµ ÐºÐ°Ð½Ð°Ð»Ñ‹"
}

main "$@"
